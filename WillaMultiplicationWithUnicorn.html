<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Times Tables 5×5 Practice</title>
    <style>
        :root {
            --bg: #0b1020;
            --ink: #e9eefb;
            --muted: #a9b3d6;
            --accent: #6aa9ff;
            --grid: #202a52;
            --ok: #1fa971;
            --bad: #e04646;
        }

        html, body {
            height: 100%;
        }

        body {
            margin: 0;
            font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
            background: radial-gradient(1200px 800px at 70% -10%, #1a2550 0%, #0b1020 40%);
            color: var(--ink);
            display: grid;
            place-items: center;
        }

        .app {
            width: min(980px,94vw);
            padding: 24px;
        }

        .card {
            background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,0));
            border: 1px solid rgba(255,255,255,.08);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,.3);
        }

        h1 {
            margin: 0 0 8px;
            font-weight: 800;
            letter-spacing: .2px;
        }

        .sub {
            color: var(--muted);
            margin-bottom: 18px;
        }

        .toolbar {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 14px;
        }

        .btn {
            appearance: none;
            border: 0;
            border-radius: 12px;
            padding: 10px 16px;
            font-weight: 700;
            background: linear-gradient(180deg,#6aa9ff,#4a7bdd);
            color: #07132b;
            cursor: pointer;
            box-shadow: 0 6px 18px rgba(77,133,255,.35);
        }

            .btn.secondary {
                background: #233163;
                color: var(--ink);
                box-shadow: none;
                border: 1px solid #2e3d78;
            }

            .btn:active {
                transform: translateY(1px);
            }

        .status {
            margin-left: auto;
            display: flex;
            gap: 18px;
            align-items: baseline;
            color: var(--muted);
        }

            .status strong {
                color: var(--ink);
                font-size: 1.05rem;
            }

        table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
        }

        th, td {
            border: 1px solid var(--grid);
        }

        th {
            background: #12193a;
            color: var(--muted);
            font-weight: 700;
        }

            th:first-child {
                background: transparent;
                border: none;
            }

        td {
            background: #0f1633;
        }

        .hdr {
            text-align: center;
            padding: 10px 6px;
            font-weight: 800;
            color: var(--ink);
        }

        input.answer {
            width: 100%;
            height: 48px;
            box-sizing: border-box;
            background: #0b1330;
            color: var(--ink);
            border: 1px solid #1b2553;
            border-radius: 8px;
            padding: 8px 10px;
            font-size: 1rem;
            text-align: center;
            outline: none;
            transition: border-color .15s, box-shadow .15s;
        }

            input.answer:focus {
                border-color: var(--accent);
                box-shadow: 0 0 0 3px rgba(106,169,255,.25);
            }

        td.correct {
            background: rgba(31,169,113,.18);
        }

        td.incorrect {
            background: rgba(224,70,70,.18);
        }

        .results {
            display: flex;
            gap: 16px;
            align-items: center;
            flex-wrap: wrap;
            margin-top: 14px;
        }

        .badge {
            padding: 6px 10px;
            border-radius: 999px;
            background: #1a2550;
            border: 1px solid #2e3d78;
            color: var(--ink);
        }

        .big {
            font-size: 1.2rem;
            font-weight: 800;
            letter-spacing: .2px;
        }

        .hidden {
            display: none !important;
        }

        /* Celebration layer */
        #celebrationLayer {
            position: fixed;
            inset: 0;
            pointer-events: none;
            z-index: 9999;
            overflow: visible;
        }

        .unicorn {
            position: absolute;
            bottom: 15%;
            left: -20%;
            width: 220px;
            height: 160px;
            will-change: transform;
            animation: gallopAcross 4.5s ease-in-out forwards;
        }

        @keyframes gallopAcross {
            0% {
                transform: translateX(0) translateY(0) scale(1);
            }

            50% {
                transform: translateX(70vw) translateY(-10px) scale(1.02);
            }

            100% {
                transform: translateX(105vw) translateY(0) scale(1);
            }
        }

        .sparkle {
            position: fixed;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,.95) 0%, rgba(255,105,180,.9) 45%, rgba(255,105,180,0) 70%);
            filter: drop-shadow(0 0 6px rgba(255,150,220,.9));
            animation: sparklePop .9s ease-out forwards;
        }

        @keyframes sparklePop {
            0% {
                opacity: 0;
                transform: scale(.4) translate(0,0);
            }

            15% {
                opacity: 1;
            }

            100% {
                opacity: 0;
                transform: scale(1.2) translate(var(--dx), var(--dy));
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="card">
            <h1>Times Tables Practice — 5×5</h1>
            <div class="sub">Click <em>Start</em> to get five unique row and column numbers (1–12). Fill all 25 boxes. Click <em>Finished</em> to grade. Correct cells go green, incorrect go red. Score = correct × (300 − seconds). Get a perfect score to see a magical surprise ✨🦄</div>
            <div class="toolbar">
                <button id="startBtn" class="btn">Start</button>
                <button id="resetBtn" class="btn secondary" disabled>Reset</button>
                <button id="finishBtn" class="btn" disabled>Finished</button>
                <div class="status">
                    <div>Timer: <strong id="timer">00:00</strong></div>
                    <div>Filled: <strong id="filledCount">0/25</strong></div>
                </div>
            </div>
            <div id="tableWrap" class="hidden"></div>
            <div id="results" class="results hidden">
                <span class="badge">Correct: <strong id="correctCount">0</strong>/25</span>
                <span class="badge">Seconds: <strong id="seconds">0</strong>s</span>
                <span class="badge big">Score: <span id="score">0</span></span>
            </div>
        </div>
    </div>
    <div id="celebrationLayer" aria-hidden="true"></div>

    <script>
        // Elements
        const startBtn = document.getElementById('startBtn');
        const resetBtn = document.getElementById('resetBtn');
        const finishBtn = document.getElementById('finishBtn');
        const tableWrap = document.getElementById('tableWrap');
        const timerEl = document.getElementById('timer');
        const filledEl = document.getElementById('filledCount');
        const results = document.getElementById('results');
        const correctCountEl = document.getElementById('correctCount');
        const secondsEl = document.getElementById('seconds');
        const scoreEl = document.getElementById('score');
        const celebrationLayer = document.getElementById('celebrationLayer');

        // State
        let rows = [], cols = [], inputs = [];
        let startTime = null, timerId = null, finished = false;

        function shuffle(a) { for (let i = a.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1));[a[i], a[j]] = [a[j], a[i]]; } return a; }
        function pickUnique(count, min = 1, max = 12) { return shuffle(Array.from({ length: max - min + 1 }, (_, i) => i + min)).slice(0, count); }
        function mmss(totalSeconds) { const m = Math.floor(totalSeconds / 60).toString().padStart(2, '0'); const s = Math.floor(totalSeconds % 60).toString().padStart(2, '0'); return `${m}:${s}`; }

        function startTimer() { startTime = Date.now(); timerId = setInterval(() => { const secs = (Date.now() - startTime) / 1000; timerEl.textContent = mmss(secs); }, 250); }
        function stopTimer() { if (timerId) clearInterval(timerId); timerId = null; }

        function buildTable() {
            rows = pickUnique(5, 1, 12); cols = pickUnique(5, 1, 12);
            const table = document.createElement('table');
            const thead = document.createElement('thead');
            const trh = document.createElement('tr');
            const corner = document.createElement('th'); corner.className = 'hdr'; trh.appendChild(corner);
            cols.forEach(c => { const th = document.createElement('th'); th.className = 'hdr'; th.textContent = c; trh.appendChild(th); });
            thead.appendChild(trh);
            const tbody = document.createElement('tbody');
            inputs = [];
            rows.forEach((r, ri) => {
                const tr = document.createElement('tr');
                const rowHdr = document.createElement('th'); rowHdr.className = 'hdr'; rowHdr.textContent = r; tr.appendChild(rowHdr);
                cols.forEach((c, ci) => {
                    const td = document.createElement('td');
                    const input = document.createElement('input');
                    input.type = 'text'; input.inputMode = 'numeric'; input.pattern = '\d*'; input.autocomplete = 'off'; input.spellcheck = false; input.className = 'answer'; input.placeholder = '×';
                    input.dataset.row = ri; input.dataset.col = ci;
                    input.addEventListener('input', (e) => { e.target.value = e.target.value.replace(/[^0-9]/g, ''); updateFilled(); });
                    input.addEventListener('keydown', (e) => {
                        const idx = inputs.indexOf(input);
                        if (e.key === 'Enter' || e.key === 'ArrowRight') { const next = inputs[idx + 1]; if (next) next.focus(); }
                        if (e.key === 'ArrowLeft') { const prev = inputs[idx - 1]; if (prev) prev.focus(); }
                        if (e.key === 'ArrowDown') { const next = inputs[idx + 5]; if (next) next.focus(); }
                        if (e.key === 'ArrowUp') { const prev = inputs[idx - 5]; if (prev) prev.focus(); }
                    });
                    td.appendChild(input); tr.appendChild(td); inputs.push(input);
                });
                tbody.appendChild(tr);
            });
            table.appendChild(thead); table.appendChild(tbody);
            tableWrap.innerHTML = ''; tableWrap.appendChild(table); tableWrap.classList.remove('hidden');
            setTimeout(() => inputs[0].focus(), 50);
        }

        function updateFilled() { const filled = inputs.filter(i => i.value.trim() !== '').length; filledEl.textContent = `${filled}/25`; }

        function grade() {
            finished = true; stopTimer(); if (finishBtn) finishBtn.disabled = true;
            let correct = 0;
            inputs.forEach((input) => {
                const ri = Number(input.dataset.row), ci = Number(input.dataset.col);
                const needed = rows[ri] * cols[ci]; const given = Number(input.value);
                const td = input.parentElement; input.disabled = true; td.classList.remove('correct', 'incorrect');
                if (given === needed) { correct++; td.classList.add('correct'); } else { td.classList.add('incorrect'); }
            });
            const secs = Math.round((Date.now() - startTime) / 1000);
            const score = Math.max(0, correct * (300 - secs));
            correctCountEl.textContent = String(correct); secondsEl.textContent = String(secs); scoreEl.textContent = String(score);
            results.classList.remove('hidden');
            resetBtn.disabled = false; startBtn.disabled = true;
            if (correct === 25) celebratePerfect();
        }

        function resetAll() { stopTimer(); finished = false; results.classList.add('hidden'); tableWrap.classList.add('hidden'); tableWrap.innerHTML = ''; timerEl.textContent = '00:00'; filledEl.textContent = '0/25'; startBtn.disabled = false; resetBtn.disabled = true; if (finishBtn) finishBtn.disabled = true; inputs = []; }

        function startGame() { resetAll(); buildTable(); startBtn.disabled = true; resetBtn.disabled = false; if (finishBtn) finishBtn.disabled = false; startTimer(); }

        // Celebration: pink unicorn + sparkles
        function celebratePerfect() {
            const unicorn = document.createElement('div');
            unicorn.className = 'unicorn';
            unicorn.innerHTML = `
            <svg viewBox="0 0 300 220" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
              <defs>
                <linearGradient id="mane" x1="0" x2="1">
                  <stop offset="0%" stop-color="#ff9bd4"/>
                  <stop offset="50%" stop-color="#ffd1f1"/>
                  <stop offset="100%" stop-color="#ff6fb3"/>
                </linearGradient>
                <filter id="glow"><feGaussianBlur stdDeviation="2" result="b"/><feMerge><feMergeNode in="b"/><feMergeNode in="SourceGraphic"/></feMerge></filter>
              </defs>
              <!-- body -->
              <ellipse cx="150" cy="140" rx="95" ry="60" fill="#ffb7d9" stroke="#ff8dc3" stroke-width="3"/>
              <!-- legs -->
              <rect x="95" y="170" width="14" height="40" rx="6" fill="#ffb7d9"/><rect x="125" y="176" width="14" height="40" rx="6" fill="#ffb7d9"/>
              <rect x="185" y="176" width="14" height="40" rx="6" fill="#ffb7d9"/><rect x="215" y="170" width="14" height="40" rx="6" fill="#ffb7d9"/>
              <!-- head -->
              <ellipse cx="70" cy="110" rx="38" ry="30" fill="#ffc4e1" stroke="#ff8dc3" stroke-width="3"/>
              <!-- horn -->
              <polygon points="58,60 70,108 82,60" fill="#ffd1f1" stroke="#ffb0db" stroke-width="3" filter="url(#glow)"/>
              <!-- ear -->
              <polygon points="88,86 98,110 78,104" fill="#ff9bd4"/>
              <!-- eye -->
              <circle cx="60" cy="113" r="5" fill="#3b255a"/>
              <!-- mane -->
              <path d="M105,90 C120,70 150,70 170,90 C160,100 140,110 120,114 C110,118 100,110 105,90 Z" fill="url(#mane)"/>
              <!-- tail -->
              <path d="M235,130 C270,130 275,150 250,165 C230,175 220,165 225,150" fill="url(#mane)"/>
              <!-- sparkles around -->
              <g fill="#ffd8f2" opacity=".9">
                <circle cx="210" cy="60" r="3"/><circle cx="240" cy="80" r="2"/><circle cx="200" cy="40" r="2"/>
              </g>
            </svg>`;

            celebrationLayer.appendChild(unicorn);

            // Emit sparkles while unicorn is flying
            const start = performance.now();
            const sparkleTimer = setInterval(() => {
                const now = performance.now();
                if (now - start > 4700) { clearInterval(sparkleTimer); }
                const rect = unicorn.getBoundingClientRect();
                const sx = rect.left + rect.width * (0.3 + Math.random() * 0.6);
                const sy = rect.top + rect.height * (0.2 + Math.random() * 0.6);
                const sp = document.createElement('span');
                sp.className = 'sparkle';
                sp.style.left = sx + 'px';
                sp.style.top = sy + 'px';
                const dx = (Math.random() * 40 - 20) + 'px';
                const dy = (Math.random() * -30 - 10) + 'px';
                sp.style.setProperty('--dx', dx); sp.style.setProperty('--dy', dy);
                celebrationLayer.appendChild(sp);
                sp.addEventListener('animationend', () => sp.remove());
            }, 60);

            unicorn.addEventListener('animationend', () => {
                unicorn.remove();
            });
        }

        // Wire up
        startBtn.addEventListener('click', startGame);
        resetBtn.addEventListener('click', resetAll);
        finishBtn.addEventListener('click', grade);
    </script>
</body>
</html>
